# name: テスト結果報告書
# description: PMBOK準拠のテスト結果報告書を自動生成して保存します

**概要**  
このコマンドは、入力情報をもとに PMBOK（主に品質マネジメント/監視コントロール領域）に準拠した「テスト結果報告書」を Markdown で生成し、`docs/test-results/` 配下に保存します。

---

## 使い方（Cursor の Custom Command へ貼り付け）
1. 下記の「**Command 定義（Markdown）**」全体をコピーして、Cursor の **Custom Commands** に新規作成で貼り付け。  
2. 実行時に **変数** を入力するか、既定値のまま実行。  
3. 指定のパス（`docs/test-results/`）にファイルが保存されます。

---

## Command 定義（Markdown）

**name:** テスト結果報告書（PMBOK準拠）生成  
**description:** 入力から PMBOK に沿ったテスト結果報告書（Markdown）を生成し、`docs/test-results/{report_date_yyyymmdd}_{project_key}_test_result.md` に保存します。  
**author:** MAKE A CHANGE / 岡村様向けテンプレ  
**version:** 1.0 (2025-10-20)

### variables
- **project_name**: プロジェクト名（例：Nova AI-PM）  
- **project_key**: プロジェクトの短い識別子（例：nova）  
- **release_version**: 対象バージョン/ビルド（例：v1.3.0 / build 1057）  
- **test_window**: テスト期間（例：2025-10-01 ～ 2025-10-20 JST）  
- **test_types**: 実施テスト種別（例：機能/回帰/結合/受入/性能/セキュリティ）  
- **env**: テスト環境（例：Staging: app.stg.example.com / DB: Aurora MySQL 3.04）  
- **criteria_summary**: 合否判定基準の要約（例：P1未解決=不可、P2≤3件=条件付き可 等）  
- **stakeholders**: 関係者（例：PM、QA、開発、プロダクトオーナー、運用）  
- **evidence_root**: 証跡格納のルート URL/パス（例：/evidence/2025-10-20/）  
- **report_date_yyyymmdd**: 報告書日付（例：20251021）  
- **notes**: 特記事項/前提・制約（任意）  

> 変数未入力時は、アシスタントがヒアリングして補完すること。

### prompt (system)
あなたはエンタープライズ開発の **品質マネジメント責任者（QAリード）** です。  
PMBOK 第7版の原則（品質、利害関係者、価値提供、適応性、測定と評価など）に整合し、**意思決定者が即座に合否を判断できる** 実務仕様の「テスト結果報告書（Markdown）」を作成してください。  
出力は **日本語**、**表や箇条書きを活用**、**欠陥と是正処置のトレーサビリティ** を明確化し、最後に **リリース可否の明確な判定** と **承認欄** を含めます。  
フォーマットは下記の **出力フォーマット** に厳密に従ってください。

### prompt (user)
以下の入力をもとに報告書を生成：

- プロジェクト名: {project_name}
- 識別子: {project_key}
- 対象バージョン/ビルド: {release_version}
- テスト期間: {test_window}
- 実施テスト種別: {test_types}
- テスト環境: {env}
- 合否判定基準（要約）: {criteria_summary}
- 関係者: {stakeholders}
- 証跡ルート: {evidence_root}
- 報告書日付: {report_date_yyyymmdd}
- 特記事項: {notes}

**要件**  
- PMBOKに沿った観点で「目的/対象範囲/前提・制約/測定指標/KPI/逸脱と是正/変更要求/承認」を網羅。  
- **実施結果サマリー（KPI）**、**詳細結果（テストケース集計）**、**欠陥一覧（優先度/状態/根因/是正）**、**リスク＆課題**、**回帰テスト計画** を含める。  
- 全ての項目は **意思決定に十分な具体度**（数値・件数・割合・リンク）で記載。  
- 「証跡リンク」は `{evidence_root}` を起点に相対パス例を提示。  
- 最終節で **リリース可否（可/条件付き可/不可）** を明記し、**条件付き可** の場合は **必須前提条件** を列挙。  
- 最後に **署名欄（PM/PO/QA/Dev/Ops）** を入れる。

**出力フォーマット（これに厳密準拠）**  
テキストは以下の Markdown だけを出力。前置き/後書き/解説は不要。

```markdown
# テスト結果報告書（PMBOK準拠）

- プロジェクト名: {project_name}
- 識別子: {project_key}
- 対象バージョン/ビルド: {release_version}
- テスト期間: {test_window}
- 報告書日付: {report_date_yyyymmdd}
- 作成: QAリード
- 関係者: {stakeholders}

---

## 1. 概要（目的・背景）
本書は、PMBOKの品質マネジメント/監視・コントロール領域に基づき、対象リリースの品質状況を評価し、リリース可否判定の根拠を示すことを目的とする。

## 2. 対象範囲（インスコープ/アウトスコープ）
- インスコープ: 主要機能／修正チケット／依存コンポーネント 等
- アウトスコープ: 将来対応項目、今回未実施の非機能テスト 等

## 3. 前提・制約・リスク受容
- 前提: {notes}
- 制約: 期間・環境・テストデータの制約 等
- 既知のリスク受容: 低影響だが解消未了の既知事象 等

## 4. テスト計画の要点
- 実施テスト種別: {test_types}
- テスト環境: {env}
- 合否判定基準（要約）: {criteria_summary}

## 5. 実施結果サマリー（KPI）
| 指標 | 値 | 目標/基準 | 判定 |
|---|---:|---:|:--:|
| 実行テストケース数 | {n_total} | - | - |
| 合格ケース数 | {n_pass} | - | - |
| 失敗ケース数 | {n_fail} | - | - |
| 未実行ケース数 | {n_na} | - | - |
| 合格率 | {pass_rate}% | ≥目標値 | ✅/⚠️/❌ |
| 重大欠陥（P1） | {p1_open} | 0 | ✅/⚠️/❌ |
| 高優先度欠陥（P2） | {p2_open} | ≤閾値 | ✅/⚠️/❌ |
| 回帰不具合再発率 | {regression_rate}% | ≤閾値 | ✅/⚠️/❌ |

## 6. 詳細結果（テストケース集計）
| 機能/領域 | 予定 | 実行 | 合格 | 失敗 | 未実行 | 合格率 |
|---|---:|---:|---:|---:|---:|---:|
| 例）認証/認可 | 120 | 118 | 116 | 2 | 2 | 98.3% |
| 例）決済 | 90 | 90 | 87 | 3 | 0 | 96.7% |
> 証跡: {evidence_root}/cases/index.md ほか

## 7. 欠陥一覧（トリアージ／根因／是正）
| ID | 優先度 | 状態 | 発生条件 | 影響範囲 | 根因（推定/確定） | 是正処置/暫定回避 | 証跡 |
|---|---|---|---|---|---|---|---|
| BUG-101 | P1 | Open | 特定条件でクラッシュ | 決済 | NPE（確定） | hotfix適用予定 | {evidence_root}/bugs/BUG-101.md |
| BUG-202 | P2 | Open | 端末依存のUI崩れ | カート | レイアウトの競合 | CSS修正／再検証 | {evidence_root}/bugs/BUG-202.md |

## 8. リスク & 課題（RAID）
- リスク: 例）外部APIのレート制限でピーク時に遅延が悪化する可能性 → 緩和策：キャッシュ強化/バックオフ
- 課題: 例）性能テスト環境のDBサイズが本番より小さく代表性が不足 → 対応：データ生成/再試験

## 9. 逸脱・例外承認（Deviation）
- 例）要件Aの一部シナリオは期限内に再現不可 → 例外承認を申請（影響軽微、代替策あり）

## 10. 是正処置・変更要求（CAPA/CR）
- CAPA: 再発防止策、検証計画、完了基準（DoD）
- 変更要求: 優先度、影響分析（スコープ/スケジュール/コスト/品質）、承認フロー

## 11. 回帰テスト計画（次アクション）
- スコープ、実施日、担当、合否基準、必要証跡の明記

## 12. 結論：リリース可否判定
- 判定: **可 / 条件付き可 / 不可**  
- 条件付き可の条件（必須前提）: 例）P1=0、P2≤3、性能95pctl ≤ 300ms など

## 13. 承認
- PO（プロダクトオーナー）: （署名・日付）
- PM（プロジェクトマネージャー）: （署名・日付）
- QA（品質保証）: （署名・日付）
- Dev（開発リード）: （署名・日付）
- Ops（運用責任者）: （署名・日付）

## 付録
- 参照文書/証跡リンク一覧: {evidence_root}/README.md
```

### actions
- **save_file**: `docs/test-results/{report_date_yyyymmdd}_{project_key}_test_result.md` に上記 Markdown を保存すること。
- **create_dirs_if_missing**: `true`
- **open_after_save**: `true`

---

## チェックリスト（実行前）
- 変数は正しく入力したか？（特に `project_key`, `report_date_yyyymmdd`）  
- 判定基準やしきい値はプロジェクト固有の値に更新したか？  
- 証跡ルートに必要なファイルが存在するか？

## 備考
- 「欠陥一覧」の列は組織標準に合わせて増減可。  
- セキュリティ/性能/アクセシビリティ等の非機能は、別セクションを追加してもよい。